<% const brandingSource = (typeof personalization !== 'undefined' && personalization) ? personalization : (locals && locals.personalization ? locals.personalization : null); %>
<% const branding = (brandingSource && brandingSource.branding) ? brandingSource.branding : {}; %>
<% const brandName = (branding && branding.name) ? branding.name : 'MASFI'; %>
<nav class="custom-navbar">
  <div class="navbar-toggle" onclick="toggleNavbar()" aria-label="<%= t('navbar.toggle', 'Abrir menú de navegación') %>">
    <i class="fas fa-bars"></i>
  </div>
  
  <div class="navbar-title">
    <a class="logo" href="/">
      <% if (branding && branding.logo) { %>
        <img src="<%= branding.logo %>" class="brand-logo" alt="<%= brandName %>">
      <% } else { %>
        <span class="brand-text"><%= brandName %></span>
      <% } %>
    </a>
  </div>

  <!-- Overlay para cerrar el menú -->
  <div class="navbar-overlay" onclick="closeNavbar()"></div>

  <ul class="navbar-menu">
    <li>
      <a href="/dashboard" class="menu-link <%= currentPath === '/dashboard' ? 'active' : '' %>" data-tooltip="<%= t('navbar.dashboard', 'Panel') %>">
        <img src="<%= (branding.icons && branding.icons.agenda) || '/icons/dashboard.webp' %>" class="icon" alt="">
        <span><%= t('navbar.dashboard', 'Panel') %></span>
      </a>
    </li>
    <li>
      <a href="/agendamientos" class="menu-link <%= currentPath === '/agendamientos' ? 'active' : '' %>" data-tooltip="<%= t('navbar.agenda', 'Agendamientos') %>">
        <img src="<%= (branding.icons && branding.icons.agenda) || '/icons/calendario.webp' %>" class="icon" alt="">
        <span><%= t('navbar.agenda', 'Agendamientos') %></span>
      </a>
    </li>
    <li>
    </li>
    <li>
      <a href="/medicos" class="menu-link <%= currentPath === '/medicos' ? 'active' : '' %>" data-tooltip="<%= t('navbar.doctors', 'Médicos') %>">
        <img src="/icons/doctor.png" alt="">
        <span><%= t('navbar.doctors', 'Médicos') %></span>
      </a>
    </li>
    <li>
      <a href="/notificaciones" class="menu-link <%= currentPath === '/notificaciones' ? 'active' : '' %>" data-tooltip="<%= t('navbar.notifications', 'Notificaciones') %>">
        <img src="/icons/notificaciones.webp" alt="" class="noti">
        <span><%= t('navbar.notifications', 'Notificaciones') %></span>
      </a>
    </li>
    <li>
      <form action="/logout" method="post">
        <button type="submit" class="logout-button">
          <span><%= t('navbar.logout', 'Cerrar Sesión') %></span>
        </button>
      </form>
    </li>
  </ul>
  <div class="reloj-wrapper" id="reloj"></div>
</nav>

<script>
  function actualizarReloj() {
    const now = new Date();
    const hh = String(now.getHours()).padStart(2, '0');
    const mm = String(now.getMinutes()).padStart(2, '0');
    const ss = String(now.getSeconds()).padStart(2, '0');
    document.getElementById('reloj').textContent = `${hh} : ${mm} : ${ss}`;
  }

  function toggleNavbar() {
    const navbar = document.querySelector('.navbar-menu');
    const overlay = document.querySelector('.navbar-overlay');
    navbar.classList.toggle('show');
    overlay.classList.toggle('show');
  }

  function closeNavbar() {
    const navbar = document.querySelector('.navbar-menu');
    const overlay = document.querySelector('.navbar-overlay');
    navbar.classList.remove('show');
    overlay.classList.remove('show');
  }

  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closeNavbar();
    }
  });

  actualizarReloj();
  setInterval(actualizarReloj, 1000);
</script>
