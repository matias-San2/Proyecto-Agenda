<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Configuración Inicial</title>
  <link rel="stylesheet" href="/css/setup.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
  <div class="wrapper setup-wrapper">
    <div class="login-box setup-box">
      <form action="/setup/create-admin" method="POST" class="setup-form">
        <h2>Configuración Inicial</h2>
        <p class="setup-subtitle">Completa los datos para personalizar tu cuenta.</p>

        <div class="setup-columns">
          <div class="setup-column">
            <h3>Datos del usuario</h3>
            <p>Información básica del administrador que gestionará la cuenta.</p>
            <div class="setup-grid single-column">
              <div class="input-box">
                <span class="icon"><i class="fa-solid fa-user"></i></span>
                <input type="text" name="fullName" required>
                <label>Nombre completo</label>
              </div>

              <div class="input-box">
                <span class="icon"><i class="fa-solid fa-envelope"></i></span>
                <input type="email" name="email" required>
                <label>Correo electrónico</label>
              </div>

              <div class="input-box">
                <span class="icon">
                  <i class="fa-solid fa-lock password-toggle" data-target="setupPassword" role="button" tabindex="0" aria-label="Mostrar contraseña"></i>
                </span>
                <input type="password" name="password" id="setupPassword" required>
                <label>Contraseña</label>
              </div>

              <div class="input-box">
                <span class="icon">
                  <i class="fa-solid fa-lock password-toggle" data-target="setupPasswordConfirm" role="button" tabindex="0" aria-label="Mostrar contraseña"></i>
                </span>
                <input type="password" name="passwordConfirm" id="setupPasswordConfirm" required>
                <label>Repetir contraseña</label>
              </div>

              <div class="password-hint">
                Tu contraseña debe contener:
                <ul>
                  <li>Mínimo 8 caracteres</li>
                  <li>1 mayúscula, 1 número y 1 símbolo</li>
                  <li>Sin espacios</li>
                </ul>
              </div>

            </div>
          </div>

          <div class="setup-column">
            <h3>Datos de la empresa</h3>
            <p>Información básica de tu organización.</p>
            <div class="setup-grid single-column">
              <div class="input-box">
                <span class="icon"><i class="fa-solid fa-building"></i></span>
                <input type="text" name="companyName" required>
                <label>Nombre de la empresa</label>
              </div>

              <div class="input-box">
                <span class="icon"><i class="fa-solid fa-id-card"></i></span>
                <input type="text" name="companyId" required>
                <label>RUT / Razón social</label>
              </div>
            </div>
          </div>
        </div>

        <button type="submit" class="setup-button">Guardar configuración</button>
      </form>
    </div>
  </div>
  <script>
    (function () {
      const passwordRegex = /^(?=.*[A-Z])(?=.*\d)(?=.*[\W_])[A-Za-z\d\W_]{8,}$/;
      const passwordInput = document.getElementById('setupPassword');
      const confirmInput = document.getElementById('setupPasswordConfirm');

      function togglePasswordVisibility(icon) {
        const targetId = icon.dataset.target;
        const input = document.getElementById(targetId);
        if (!input) return;
        const isHidden = input.type === 'password';
        input.type = isHidden ? 'text' : 'password';
        icon.classList.toggle('fa-lock', !isHidden);
        icon.classList.toggle('fa-lock-open', isHidden);
        icon.setAttribute('aria-label', isHidden ? 'Ocultar contraseña' : 'Mostrar contraseña');
      }

      function preventSpaces(event) {
        if (event.key === ' ') {
          event.preventDefault();
        }
      }

      function validatePasswordRules() {
        if (!passwordInput) return;
        const value = passwordInput.value;
        if (!passwordRegex.test(value)) {
          passwordInput.setCustomValidity('La contraseña no cumple los requisitos.');
        } else {
          passwordInput.setCustomValidity('');
        }
        validateConfirmPassword();
      }

      function validateConfirmPassword() {
        if (!passwordInput || !confirmInput) return;
        if (confirmInput.value !== passwordInput.value) {
          confirmInput.setCustomValidity('Las contraseñas no coinciden.');
        } else {
          confirmInput.setCustomValidity('');
        }
      }

      document.querySelectorAll('.password-toggle').forEach(icon => {
        icon.addEventListener('click', () => togglePasswordVisibility(icon));
        icon.addEventListener('keydown', event => {
          if (event.key === 'Enter' || event.key === ' ') {
            event.preventDefault();
            togglePasswordVisibility(icon);
          }
        });
      });

      if (passwordInput) {
        passwordInput.addEventListener('keydown', preventSpaces);
        passwordInput.addEventListener('input', validatePasswordRules);
        passwordInput.addEventListener('blur', validatePasswordRules);
      }

      if (confirmInput) {
        confirmInput.addEventListener('keydown', preventSpaces);
        confirmInput.addEventListener('input', validateConfirmPassword);
        confirmInput.addEventListener('blur', validateConfirmPassword);
      }

      function updateFloatingLabelState(field) {
        if (!field) return;
        const hasValue = field.value && field.value.trim() !== '';
        field.classList.toggle('has-value', hasValue);
      }

      document.querySelectorAll('.input-box input, .input-box select').forEach(field => {
        updateFloatingLabelState(field);
        field.addEventListener('input', () => updateFloatingLabelState(field));
        field.addEventListener('change', () => updateFloatingLabelState(field));
        field.addEventListener('blur', () => updateFloatingLabelState(field));
      });

    })();
  </script>
</body>
</html>
