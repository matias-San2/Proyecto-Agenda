<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Agenda</title>
  <link rel="stylesheet" href="/css/navbar.css">
  <link rel="stylesheet" href="/css/agenda.css">
  <link rel="stylesheet" href="/css/footer.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  
  <!-- Variables CSS personalizadas -->
  <style>
        :root {
        --personalization-loaded: true;
        
        <% if (personalization && personalization['theme.primary_color']) { %>
        --primary-color: <%= personalization['theme.primary_color'] %>!important;
        <% if (personalization['theme.primary_color_light']) { %>
        --primary-color-light: <%= personalization['theme.primary_color_light'] %>!important;
        <% } %>
        <% if (personalization['theme.primary_color_dark']) { %>
        --primary-color-dark: <%= personalization['theme.primary_color_dark'] %>!important;
        <% } %>
        <% } %>
        
        <% if (personalization && personalization['theme.mode'] === 'dark') { %>
        --background-color: #181818 !important;
        --text-color: rgba(241, 241, 241, 0.98) !important;
        --secondary-text-color: #aab1bb !important;
        --card-background: #222222 !important;
        --border-color: #2b2b2b !important;
        <% } %>
        }
        <% if (personalization && personalization['theme.mode'] === 'dark') { %>
        .menu-link img {
            filter: brightness(0) invert(1)!important;
        }
        <% } %>
    </style>
</head>
<body data-theme="<%= personalization['theme.mode'] || 'light' %>">
  <div class="container-fluid">
    <div class="row">
      <%- include('navbar') %>

      <div class="main">
        <div class="top-header">
          <h1 class="page-title">Sistema de Agenda</h1>
          <p class="page-subtitle">Gestiona tu agenda médica de forma eficiente</p>
        </div>

        <div class="row g-4 gap-5 justify-content-center">
          
          <!-- Sección de Gestión de Agenda - Requiere agenda.read -->
          <% if (canViewAgenda) { %>
            <div class="section data-section col-12 col-md-5">
              <div class="section-header">
                <div class="section-icon">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                </div>
                <h2 class="section-title">Gestión de Agenda</h2>
                <p class="section-description">Visualiza y administra tus citas médicas</p>
              </div>

              <div class="row gy-4 justify-content-center">
                <div class="col-12 col-sm-11 col-md-11 col-lg-6">
                  <a href="/agenda/calendario/box" class="option-card">
                    <i class="fa-solid fa-boxes-stacked"></i>
                    <span>Box</span>
                  </a>
                </div>
                <div class="col-12 col-sm-11 col-md-11 col-lg-6">
                  <a href="/agenda/calendario/medico" class="option-card">
                    <i class="fa-solid fa-user-doctor" aria-hidden="true"></i>
                    <span>Médico</span>
                  </a>
                </div>
              </div>
            </div>
          <% } %>

          <!-- Sección de Gestión de Datos - Requiere data.import O data.export -->
          <% if (canImport || canExport) { %>
            <div class="section data-section col-12 col-md-5">
              <div class="section-header">
                <div class="section-icon">
                  <i class="fas fa-exchange-alt" aria-hidden="true"></i>
                </div>
                <h2 class="section-title">Gestión de Datos</h2>
                <p class="section-description">Exporta e importa información de consultas</p>
              </div>

              <div class="row gy-4 justify-content-center">
                <!-- Solo mostrar Importar si tiene permiso -->
                <% if (canImport) { %>
                  <div class="col-12 col-sm-11 col-md-11 col-lg-6">
                    <a href="/importar" class="option-card">
                      <i class="fas fa-download" aria-hidden="true"></i>
                      <span>Importar</span>
                    </a>
                  </div>
                <% } %>
                
                <!-- Solo mostrar Exportar si tiene permiso -->
                <% if (canExport) { %>
                  <div class="col-12 col-sm-11 col-md-11 col-lg-6">
                    <a href="/exportar" class="option-card">
                      <i class="fas fa-upload" aria-hidden="true"></i>
                      <span>Exportar</span>
                    </a>
                  </div>
                <% } %>
              </div>
            </div>
          <% } %>

          <!-- Mensaje si no tiene permisos para ninguna sección -->
          <% if (!canViewAgenda && !canImport && !canExport) { %>
            <div class="col-12 text-center">
              <div class="alert alert-warning">
                <h4>Sin permisos disponibles</h4>
                <p>No tienes permisos para acceder a ninguna sección de la agenda. Contacta al administrador.</p>
              </div>
            </div>
          <% } %>

        </div>
      </div>

      <%- include('footer') %>
    </div>
  </div>

<script>
    window.userPersonalization = <%- JSON.stringify(personalization || {}) %>;
</script>
</body>
</html>