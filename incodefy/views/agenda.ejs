<!DOCTYPE html>
<html lang="<%= i18n.language %>">
<head>
  <meta charset="UTF-8">
  <title><%= t('agenda.title') %></title>
  <link rel="stylesheet" href="/css/navbar.css">
  <link rel="stylesheet" href="/css/agenda.css">
  <link rel="stylesheet" href="/css/footer.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  
  <!-- El bloque <style> se ha eliminado y se reemplaza por esta línea -->
  <%- include('partials/personalization-styles') %>

</head>
<body data-theme="<%= (locals.personalization && personalization['theme.mode']) || 'light' %>">
  <div class="container-fluid">
    <div class="row">
      <%- include('navbar') %>

      <div class="main">
        <div class="top-header">
          <h1 class="page-title"><%= t('agenda.main_title') %></h1>
          <p class="page-subtitle"><%= t('agenda.main_subtitle') %></p>
        </div>

        <div class="row g-4 gap-5 justify-content-center">
          
          <!-- Sección de Gestión de Agenda - Requiere agenda.read -->
          <% if (canViewAgenda) { %>
            <div class="section data-section col-12 col-md-5">
              <div class="section-header">
                <div class="section-icon">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                </div>
                <h2 class="section-title"><%= t('agenda.management.title') %></h2>
                <p class="section-description"><%= t('agenda.management.description') %></p>
              </div>

              <div class="row gy-4 justify-content-center">
                <div class="col-12 col-sm-11 col-md-11 col-lg-6">
                  <a href="/agenda/calendario/box" class="option-card">
                    <i class="fa-solid fa-boxes-stacked"></i>
                    <span><%= t('agenda.management.box') %></span>
                  </a>
                </div>
                <div class="col-12 col-sm-11 col-md-11 col-lg-6">
                  <a href="/agenda/calendario/medico" class="option-card">
                    <i class="fa-solid fa-user-doctor" aria-hidden="true"></i>
                    <span><%= t('agenda.management.doctor') %></span>
                  </a>
                </div>
              </div>
            </div>
          <% } %>

          <!-- Sección de Gestión de Datos - Requiere data.import O data.export -->
          <% if (canImport || canExport) { %>
            <div class="section data-section col-12 col-md-5">
              <div class="section-header">
                <div class="section-icon">
                  <i class="fas fa-exchange-alt" aria-hidden="true"></i>
                </div>
                <h2 class="section-title"><%= t('agenda.data.title') %></h2>
                <p class="section-description"><%= t('agenda.data.description') %></p>
              </div>

              <div class="row gy-4 justify-content-center">
                <!-- Solo mostrar Importar si tiene permiso -->
                <% if (canImport) { %>
                  <div class="col-12 col-sm-11 col-md-11 col-lg-6">
                    <a href="/importar" class="option-card">
                      <i class="fas fa-download" aria-hidden="true"></i>
                      <span><%= t('agenda.data.import') %></span>
                    </a>
                  </div>
                <% } %>
                
                <!-- Solo mostrar Exportar si tiene permiso -->
                <% if (canExport) { %>
                  <div class="col-12 col-sm-11 col-md-11 col-lg-6">
                    <a href="/exportar" class="option-card">
                      <i class="fas fa-upload" aria-hidden="true"></i>
                      <span><%= t('agenda.data.export') %></span>
                    </a>
                  </div>
                <% } %>
              </div>
            </div>
          <% } %>

          <!-- Mensaje si no tiene permisos para ninguna sección -->
          <% if (!canViewAgenda && !canImport && !canExport) { %>
            <div class="col-12 text-center">
              <div class="alert alert-warning">
                <h4><%= t('agenda.no_permissions.title') %></h4>
                <p><%= t('agenda.no_permissions.description') %></p>
              </div>
            </div>
          <% } %>

        </div>
      </div>

      <%- include('footer') %>
    </div>
  </div>

<script>
    window.userPersonalization = <%- JSON.stringify(personalization || {}) %>;
</script>
</body>
</html>